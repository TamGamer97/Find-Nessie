<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, 
user-scalable=yes">
    <title>Nessie Game</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9762342374717320" crossorigin="anonymous"></script>
</head>
<body id="body">

    
    <div style="display: flex; justify-content: center; height: 100%;">
        <img src="/Assets/BannerTransparent.png" style="width: 850px; height: 180px; object-fit: contain; position: absolute; top: 0px;">
        
        <div id="parentImage" style="width: 1050px; height: 600px; margin-top: 150px; display: flex; justify-content: center; align-items: center; align-content: flex-start; flex-direction: column;">
            <div id="txtHeadersContainer" style="width: 1050px; height: 30px; display: flex; flex-direction: row; border: none; position: relative; justify-content: center;">
                <h1 id="prevLevTxt" class="headingTxt" onclick="changeGames('back')" style="font-size: 19px; margin-top: 3px; text-align: start; width: 200px; position: absolute; left: 0px; border: none; cursor: pointer;">&larr; Previous Level</h1>
                <h1 id="levelTitle" style="font-size: 19px; margin-top: 3px; text-align: center; width: 200px; position: absolute; border: none; color: grey; "></h1>
                <h1 id="nxtLevTxt" class="headingTxt" onclick="changeGames('forward')" style="font-size: 19px; margin-top: 3px; text-align: end; width: 200px; position: absolute; right: 0px; border: none; cursor: pointer;">Next Level &rarr;</h1>
            </div>
            <img id="mainImage" src="/Assets/blackLoading.gif" style="object-fit: cover; border: solid #2E323E 0px; margin-top: 30px;">
            
            <div id="levelsMenu" style="display: none; width: 1050px; height: 600px; flex-direction: row; flex-wrap: wrap; align-items: stretch; justify-content: flex-start; align-self: auto; align-content: stretch;">
                <!-- <div class="levelBtn" title="menu" onclick="toggleMenu()" style="width: 75px; height: 75px; border-radius: 20px; cursor: pointer; margin-left: 20px; margin-top: 20px;">
                    <h1 style="color: white; text-align: center;">1</h1>
                </div> -->
                </div>
            </div>
        </div>

        <div class="sideBtns" title="random" onclick="location.href = '/' " style="width: 75px; height: 75px; position: absolute; left: 60px; top: 350px; display: flex; justify-content: center; align-items: center; border-radius: 20px; cursor: pointer;">
            <img src="/Assets/RefreshIcon.png" style="width: 50px; height: 50px; left: 30px; top: 350px;">
        </div>

        <div class="sideBtns" title="menu" onclick="toggleMenu()" style="width: 75px; height: 75px; position: absolute; left: 60px; top: 450px; display: flex; justify-content: center; align-items: center; border-radius: 20px; cursor: pointer;">
            <img src="/Assets/menuIcon.png" style="width: 50px; height: 50px; left: 30px; top: 350px;">
        </div>

        <div class="sideBtns" title="Information" onclick="promptOpen('i')" style="width: 75px; height: 75px; position: absolute; top: 30px; right: 375px; display: flex; justify-content: center; align-items: center; border-radius: 20px; cursor: pointer; z-index: 10;">
            <img src="/Assets/InformationIcon.png" style="width: 30px; height: 30px; left: 30px; top: 350px;">
        </div>
        
        <div class="sideBtns" title="How to play" onclick="promptOpen('?')" style="width: 75px; height: 75px; position: absolute; top: 30px; right: 290px; display: flex; justify-content: center; align-items: center; border-radius: 20px; cursor: pointer; z-index: 10;">
            <img src="/Assets/questionmarkIcon.png" style="width: 30px; height: 30px; left: 30px; top: 350px;">
        </div>

        <div class="sideBtns" title="Share" onclick="promptOpen('shared')" style="width: 75px; height: 75px; position: absolute; top: 30px; right: 205px; display: flex; justify-content: center; align-items: center; border-radius: 20px; cursor: pointer; z-index: 10;">
            <img src="/Assets/shareArrow.png" style="width: 30px; height: 30px; left: 30px; top: 350px;">
        </div>

        <div title="streak" id="streakBtn" style="width: 140px; height: 75px; background-color: #4ffa8f; position: absolute; top: 30px; right: 45px; display: flex; justify-content: center; align-items: center; border-radius: 20px; cursor: pointer; z-index: 10;">
            <h1 id="streakTxt" style="color: black; margin-left: 15px; ">-</h1>
            <img src="/Assets/streakIcon.png" style="width: 40px; height: 40px;">
        </div>

        <h1 id="winningTxt" style="color: white; background-color: #2e323e; visibility: hidden; padding: 10px; border-radius: 10px; text-align: center; color: #4ffa8f; border: solid #4ffa8f 2px; position: absolute; width: 310px; height: 40px; top: 950px; transition: 1s; font-family: Jua; font-weight: 500;">You found Nessie! <span style="color: red;">&#9829;</span>  </h1>

        <!-- <div style="width: 50vw; height: 10vh; background-color: white; position: absolute; bottom: 0px;">

        </div> -->

        <div id="promptContainer" style="display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; position: absolute; top: 0px; left: 0px; z-index: -1;">
            <div id="iPrompt" style="width: 750px; height: 350px; border-radius: 20px; background-color: #2E323E; border: solid #50ff92 2px; position: absolute; bottom: -360px; display: flex; justify-content: center; align-items: center; transition: 1s; visibility: hidden;">
                <h1 style="color: white; font-family: Jua; font-weight: 100; text-align: center; font-size: 25px;">
                    A game for nessie lovers! <br><br>

                    Here is our Privacy and Cookie Policy <br> <span onclick=" window.open('/Policies/Privacy-Policy.pdf', '_blank') " style="color: #50ff92; cursor: pointer;">Privacy Policy</span> <span onclick="window.open('/Policies/Cookie-Policy.pdf', '_blank') " style="color: #50ff92; cursor: pointer;">Cookie Policy</span> <br> <br>

                    Do you want to submit your own art? Questions or suggestions? Contact us at <span style="color: #50ff92; cursor: pointer;">sleepycloudsgames@gmail.com</span> <br> <br>
                    
                    Do you want to support us? Show your support at <br> <span onclick="window.open('https://ko-fi.com/cloudygamesmage', '_blank') " style="color: #50ff92; cursor: pointer;">https://ko-fi.com/cloudygamesmage</span>
                    
                </h1>
                <h1 class="closeTxt" onclick="promptOpen('i')" style="position: absolute; top: -10px; right: 20px; font-family: Jua;">X</h1>
            </div>
            <div id="?Prompt" style="width: 750px; height: 300px; border-radius: 20px; background-color: #2E323E; border: solid #50ff92 2px; position: absolute; bottom: -350px; display: flex; justify-content: center; align-items: center; transition: 1s; visibility: hidden;">
                <h1 style="color: white; font-family: Jua; font-weight: 100; text-align: center; font-size: 25px;">
                    Instructions: <br> <br>
    
                    <span style="font-weight: 800;">&bull;</span> Find the Nessie <br> <br>
    
                    <span style="font-weight: 800;">&bull;</span> Only one per level <br> <br>
    
                    <span style="font-weight: 800;">&bull;</span> Every 10 levels there is a special level <br> <br>
                </h1>
                <h1 class="closeTxt" onclick="promptOpen('?')" style="position: absolute; top: -10px; right: 20px; font-family: Jua;">X</h1>
            </div>
            <div id="sharePrompt" style="width: 750px; height: 50px; border-radius: 20px; background-color: #2E323E; border: solid #50ff92 2px; position: absolute; bottom: -60px; display: flex; justify-content: center; align-items: center; transition: 0.2s; visibility: hidden;">
                <h1 style="color: white; font-family: Jua; font-weight: 100; text-align: center; font-size: 25px;">
                    Copied to clipboard
                </h1>
            </div>
        </div>

        <div id="cookiesPopup" style="position: absolute; display: none; bottom: 10px; right: 10px; width: 420px; height: 210px; border-radius: 10px; background-color: #121212;">
            <h1 style="color: white; font-size: 23px; margin-left: 20px; margin-top: 20px; font-weight: 600;">We use cookies</h1>
            <h1 style="color: white; font-size: 14px; margin-left: 20px; margin-top: -10px; font-weight: 400; width: 360px;">We use cookies and other tracking technologies to improve your browsing experience on our website, to show you personalized content and targeted ads, to analyze our website traffic, and to understand where our visitors are coming from.</h1>
            <div style="display: flex; margin-top: 15px;">
                <div onclick="toggleCookiesPermission(0)" style="width: 80px; height: 35px; border-radius: 5px; margin-left: 20px; background-color: #585deb; cursor: pointer;">
                    <h1 style="font-size: 15px; text-align: center; margin-top: 8px;">I agree</h1>
                </div>
                <div onclick="toggleCookiesPermission(1)" style="width: 80px; height: 35px; border-radius: 5px; margin-left: 10px; background-color: #585deb; cursor: pointer;">
                    <h1 style="font-size: 15px; text-align: center; margin-top: 8px;">I decline</h1>
                </div>
                <div onclick="toggleCookiesPermission(2)" style="width: 190px; height: 35px; border-radius: 5px; margin-left: 10px; background-color: white; cursor: pointer;">
                    <h1 style="font-size: 15px; text-align: center; margin-top: 8px;">Change my preferences</h1>
                </div>
            </div>
        </div>

    </div>


    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9762342374717320" crossorigin="anonymous"></script>

    <div style="position: absolute; top: 0px; left: 0px; z-index: 10;">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9762342374717320" crossorigin="anonymous"></script>
        <!-- Homepage Leaderboard -->
        <ins class="adsbygoogle"
        style="display:inline-block;width:728px;height:90px"
        data-ad-client="ca-pub-9762342374717320"
        data-ad-slot="9762342374717320"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>


    </div>

</body>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>

<script type="module" src="index.js"></script>
<script type="module">
    import {getData} from './index.js'

    async function getImages()
    {
        const Games = await getData()
        startGame(Games)
    }

    getImages()

</script>
<script>


    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    var latestGames;

    var imageURL = ''
    var imageTargetLocation = [] // x,y,radius

    var cookiesAllow = false

    if(isMobile)
    {
        document.getElementById('winningTxt').style.left = (window.innerHeight / 2) - 155 + 'px'
    }else{
        document.getElementById('winningTxt').style.left = (window.innerWidth / 2) - 155 + 'px'
    }

    function startGame(games)
    {
        document.getElementById('mainImage').style.border ='solid #2E323E 10px'
        console.log(games)

        latestGames = games
        
        const l = Cookies.get('level')

        if(l != undefined)
        {
            console.log('loading level '+l+' specificly')
            var levelIndex = JSON.parse(l)
            Cookies.remove('level')
        }else{
            var max = games.length - 1
            var min = 0
            // var levelIndex = Math.floor(Math.random() * (max - min + 1)) + min; random level
            var levelIndex = games.length - 1
        }

        document.getElementById('prevLevTxt').innerHTML = ' &larr;' + (JSON.parse(levelIndex))
        document.getElementById('levelTitle').innerHTML = 'Level ' + (JSON.parse(levelIndex) + 1)
        document.getElementById('nxtLevTxt').innerHTML =  (JSON.parse(levelIndex) + 2) + ' &rarr;'
        
        if(levelIndex == 0)
        {
            document.getElementById('prevLevTxt').style.color = 'grey'
            document.getElementById('prevLevTxt').style.opacity = 0.3

            // document.getElementById('prevLevTxt').innerHTML = ''
        }
        if(levelIndex == games.length - 1)
        {
            document.getElementById('nxtLevTxt').style.color = 'grey'
            document.getElementById('nxtLevTxt').style.opacity = 0.3

            // document.getElementById('nxtLevTxt').innerHTML =  ''
        }


        console.log('image: ' + levelIndex)
        console.log(games[levelIndex])

        document.getElementById('mainImage').src = games[levelIndex].imageURL
        imageTargetLocation = games[levelIndex].target

        document.getElementById('mainImage').style.width = '1050px' // 1050
        document.getElementById('mainImage').style.height = '600px' // 600

        if(cookiesAllow)
        {
            try{
    
                var s = Cookies.get('streak')
                s = JSON.parse(s)
        
                document.getElementById('streakTxt').innerHTML = s.length
    
                if(s.length == 0)
                {
                    document.getElementById('streakBtn').style.display = 'none'
                }
            }catch{
                s = []
                Cookies.set('streak', '[]')
    
    
            }
        }

    }

    function changeGames(direction)
    {
        if(direction == 'back')
        {
            if(document.getElementById('prevLevTxt').style.opacity != 0.3)
            {
                const l = JSON.stringify(JSON.parse(document.getElementById('levelTitle').innerHTML.split('Level ')[1])- 2)
                clickLevel(l)
            }
        }
        if(direction == 'forward')
        {
            if(document.getElementById('nxtLevTxt').style.opacity != 0.3)
            {
                const l = JSON.stringify(JSON.parse(document.getElementById('levelTitle').innerHTML.split('Level ')[1]))
                clickLevel(l)
            }
        }
    }

    function foundNessie()
    {
        var audio = new Audio('/Assets/Nsqueek.mp3');
        audio.play();

        document.getElementById('winningTxt').style.visibility = 'visible'
        document.getElementById('winningTxt').style.top = '600px' // 800px

        const timeTillNextRound = 1 // seconds

        
        const currentLevel = document.getElementById('levelTitle').innerHTML.split('Level ')[1]
        
        if(cookiesAllow)
        {
            var s = Cookies.get('streak')
            s = JSON.parse(s)
    
            var foundLevelInStreak = false
            for (streakIndex in s)
            {
                const streak = s[streakIndex]
                if(streak == currentLevel)
                {
                    foundLevelInStreak = true
                    break
                }
            }
            
            if(foundLevelInStreak == false)
            {
                console.log(s)
                s.push(currentLevel)
        
                const stringedStreak = JSON.stringify(s)
                Cookies.set('streak', stringedStreak)
            }
        }

        // setTimeout(() => {
        //     changeGames('forward')
        // }, timeTillNextRound*1000);
    }

    var promptIsAnim = false;
    var promptIsActive = []
    function promptOpen(type)
    {
        if(type == 'shared')
        {
            if(document.getElementById('sharePrompt').style.bottom == '-60px')
            {
                document.getElementById('sharePrompt').style.visibility = 'visible'
                document.getElementById('sharePrompt').style.bottom = '30px'

                const copyContent = async () => {
                    try {
                        await navigator.clipboard.writeText('https://find-nessie.com');
                        console.log('Content copied to clipboard');
                    } catch (err) {
                        console.error('Failed to copy: ', err);
                    }
                }

                copyContent()

                setTimeout(() => {
                    document.getElementById('sharePrompt').style.visibility = 'hidden'
                    document.getElementById('sharePrompt').style.bottom = '-60px'
                    setTimeout(() => {
                    }, 1000);
                }, 1500);
            }
        }

        if(promptIsAnim)
        {
            return
        }
        if(promptIsActive.length != '')
        {
            if(promptIsActive != type)
            {
                return
            }
        }

        if(type == 'i')
        {
            if(document.getElementById('iPrompt').style.bottom == '-360px')
            {
                document.getElementById('iPrompt').style.visibility = 'visible'
                document.getElementById('iPrompt').style.bottom =(window.innerHeight / 2)-125 + 'px'
                document.getElementById('promptContainer').style.zIndex = 1
                promptIsActive = type
            }else{
                document.getElementById('iPrompt').style.bottom = '-360px'
                promptIsAnim = true
                setTimeout(() => {
                    document.getElementById('iPrompt').style.visibility = 'hidden'
                    document.getElementById('promptContainer').style.zIndex = -1
                    promptIsAnim = false
                    promptIsActive = ''
                }, 1000);
            }
        }
        if(type == '?')
        {
            if(document.getElementById('?Prompt').style.bottom == '-350px')
            {
                document.getElementById('?Prompt').style.visibility = 'visible'
                document.getElementById('?Prompt').style.bottom =(window.innerHeight / 2)-150 + 'px'
                document.getElementById('promptContainer').style.zIndex = 1
                promptIsActive = type
            }else{
                document.getElementById('?Prompt').style.bottom = '-350px'
                promptIsAnim = true
                setTimeout(() => {
                    document.getElementById('?Prompt').style.visibility = 'hidden'
                    document.getElementById('promptContainer').style.zIndex = -1
                    promptIsAnim = false
                    promptIsActive = ''
                }, 1000);
            }
        }
    }

    function clickLevel(levelNumber)
    {
        Cookies.set('level', levelNumber)
        location.href = '/'
    }

    function handleCookiePopup()
    {
        const ce = Cookies.get('cookiesEnabled')
        if(ce == undefined)
        {
            // show label
            document.getElementById('cookiesPopup').style.display = 'block'
        }

        if(ce == 'true')
        {
            cookiesAllow = true
        }


    }
    handleCookiePopup()

    function toggleCookiesPermission(btnNo)
    {
        document.getElementById('cookiesPopup').style.display = 'none'
        if(btnNo == 0)
        {
            Cookies.set('cookiesEnabled', 'true')
        }
        if(btnNo == 1)
        {
            Cookies.set('cookiesEnabled', 'false')
        }
        if(btnNo == 2)
        {
            window.open('https://support.google.com/accounts/answer/61416?hl=en&co=GENIE.Platform%3DDesktop', '_blank')
        }
    }

    function toggleMenu()
    {
        if(document.getElementById('mainImage').style.display != 'none')
        {
            document.getElementById('mainImage').style.display = 'none'
            document.getElementById('parentImage').style.backgroundColor = '#2E323E'

            document.getElementById('levelsMenu').style.display = 'flex'

            document.getElementById('levelsMenu').innerHTML = ''

            document.getElementById('txtHeadersContainer').style.display = 'none'
            
            

            for (gInd in latestGames)
            {
                const g = latestGames[gInd]

                const levelNumber = gInd 

                // var leftAmount = (10 * (gInd + 1)) + 250
                // var topAmount = 170

                // if(gInd >= 10) // 11th item in the display
                // {
                //     leftAmount = (10 * (gInd-10 + 1)) + 250
                //     topAmount = 250
                // }
                
                // console.log(gInd + ' ' + leftAmount)

                const e = document.createElement('div')
                e.setAttribute('class', 'levelBtn')
                e.setAttribute('title', 'menu')
                e.setAttribute('onclick', 'clickLevel('+levelNumber+')')
                e.style = 'width: 75px; height: 75px; border-radius: 20px; cursor: pointer; margin-left: 15px; margin-top: 20px; position: relative;'
                e.innerHTML = '<h1 style="color: white; text-align: center;">'+(JSON.parse(levelNumber) + 1)+'</h1>'
                document.getElementById('levelsMenu').appendChild(e)
            }

        }else{
            document.getElementById('mainImage').style.display = 'flex'
            document.getElementById('parentImage').style.backgroundColor = 'transparent'

            document.getElementById('levelsMenu').style.display = 'none'

            document.getElementById('txtHeadersContainer').style.display = 'flex'

            document.getElementById('levelsMenu').innerHTML = ''
        }
    }

    function trackMousePos()
    {
        let check = false;

        var zoom=1;
        
        if(isMobile)
        {
            console.log('zooming, detected mobile')
            zoom = 0.45
            document.body.style.zoom = zoom
            screen.orientation.lock('landscape');
        }
        document.getElementById('body').requestFullscreen()
        addEventListener('mousedown', (event)=>{
            
            console.log(event.clientX + ' ' + event.clientY) // 600 459 // 1372 458

            var x = event.clientX
            var y = event.clientY

            const radius = imageTargetLocation[2]
            
            if((x - document.getElementById('mainImage').offsetLeft) - imageTargetLocation[0] < radius && (x - document.getElementById('mainImage').offsetLeft) - imageTargetLocation[0] > -radius + (radius))
            {
                if((y - document.getElementById('mainImage').offsetTop) - imageTargetLocation[1] < radius && (y - document.getElementById('mainImage').offsetTop) - imageTargetLocation[1] > -radius + (radius))
                {
                    console.log(x + ' ' + y)
                    console.log('relative: ')
                    console.log(x - document.getElementById('mainImage').offsetTop + ' ' + y - document.getElementById('mainImage').offsetTop)
                    console.log('Nessie!')
                    foundNessie()
                }
            }
        })

        document.getElementById('body').addEventListener('touchstart', (e)=>{

            var b = document.getElementById('body').getBoundingClientRect()

            var x = e.touches[0].clientX * (1/zoom);
            var y = e.touches[0].clientY * (1/zoom);

            console.log(x + ' ' + y)
            
            const radius = imageTargetLocation[2]

            console.log('distanec: ' + (x - (document.getElementById('mainImage').offsetLeft) - imageTargetLocation[0]) )
            
            if((x - (document.getElementById('mainImage').offsetLeft)) - imageTargetLocation[0] < radius && (x - (document.getElementById('mainImage').offsetLeft)) - imageTargetLocation[0] > -radius + (radius))
            {
                if((y - (document.getElementById('mainImage').offsetTop)) - imageTargetLocation[1] < radius && (y - (document.getElementById('mainImage').offsetTop)) - imageTargetLocation[1] > -radius + (radius))
                {
                    console.log(x + ' ' + y)
                    console.log('relative: ')
                    console.log(x - (document.getElementById('mainImage').offsetTop) + ' ' + y - (document.getElementById('mainImage').offsetTop))
                    console.log('Nessie!')
                    foundNessie()
                }
            }
        })
    }
    trackMousePos()


</script>
</html>

<style>
    body{
        background-color: black; /* 1D2029 */ 
        font-family: sans-serif;
        overflow: hidden;
    }
    @font-face{
        font-family: Jua;
        src: url(/Assets/Fonts/Jua-Regular.ttf);
    }
    .sideBtns{
        background-color: #2e323e;
    }
    .sideBtns:hover{
        background-color: #3a4050;
    }

    .levelBtn{
        background-color: #3a4050;
    }
    .levelBtn:hover{
        background-color: #454e65;
    }

    .headingTxt{
        color: grey;
    }
    .headingTxt:hover{
        color: #50ff92;
    }
    .closeTxt{
        color: white;
    }
    .closeTxt:hover{
        color: #50ff92;
        cursor: pointer;
    }
</style>